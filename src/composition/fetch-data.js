const urlTable = {
  getBooks: "http://localhost:2044/api/getBooks",
  upload: "http://localhost:2044/api/upload",
};
async function getServerData(output, url) {
  await fetch(urlTable[url])
    .then((response) => response.json())
    .then((result) => {
      output.value = result;
      console.log(result);
    })
    .catch((err) => console.log(err));
}

// async function getServerData(output, url) {
//   const response = await fetch(urlTable[url]);
//   const reader = response.body.getReader();

//   // eslint-disable-next-line no-constant-condition
//   while (true) {
//     const {value, done} = await reader.read();
//     if (done) break;
//     let streamData = new TextDecoder().decode(value);
//     // console.log('Received', streamData);
//     if (streamData.indexOf('result') !== -1) {
//       let data = JSON.parse(streamData)
//       console.log(data.result);
//       output.value = data.result;
//     } else {
//       console.log(streamData);
//     }
//   }
// }

async function getServerStreamData(output, url) {
  const response = await fetch(urlTable[url]);
  const reader = response.body.getReader();
  
    // eslint-disable-next-line no-constant-condition
    while (true) {
      const {value, done} = await reader.read();
      if (done) break;
      let streamData = new TextDecoder().decode(value);
      // console.log('Received', streamData);
      if (streamData.indexOf('result') !== -1) {
        let data = JSON.parse(streamData)
        console.log(data.result);
        output.value = data.result;
      } else {
        console.log(streamData);
      }
    }
    // await fetch(urlTable[url]).then(async (response) => {
    // for (const reader = response.body.getReader(); ; ) {
    //   const { value, done } = await reader.read();

    //   if (done) {
    //     break;
    //   }

    //   console.log("Got from server", new TextDecoder().decode(value));
    // }
  // });
}

export { getServerData, getServerStreamData };

/** {"id":{"rusName":"ID","data":"558459323","field":"tag='001'"},"author":{"rusName":"Автор","data":"Антон Павлович Чехов","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Каштанка","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"44 с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Детская литература","Сказки, стихи, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2014","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Спирин Г. Геннадий"],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, достигших возраста шести лет"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-386-07699-3","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"625370511","field":"tag='001'"},"author":{"rusName":"Автор","data":"Элизабет Гилберт","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Есть, молиться, любить","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"605, [2] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Проза зарубежная","Романы, повести, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2011","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Змеева Ю. Ю."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-386-02473-4","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"570535922","field":"tag='001'"},"author":{"rusName":"Автор","data":"Джанни Родари","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Сказки по телефону","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"76, [3] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Детская литература","Сказки, стихи, рассказы","(х. л.) -- (д. л.)"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2013","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Лебедева Н. Наталия","Канивец В. М. Владимир Михайлович 1957-"],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, не достигших возраста шести лет","для детей младшего школьного возраста (1 - 3 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-699-66952-3","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"392053476","field":"tag='001'"},"author":{"rusName":"Автор","data":"Валентина Александровна Осеева","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Волшебное слово","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"77 с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Детская литература","Сказки, стихи, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2017","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Глазов И.","Запесочная Е. Елена","Каневский В."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, не достигших возраста шести лет","для детей младшего школьного возраста (1 - 3 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-17-084083-0","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"367130515","field":"tag='001'"},"author":{"rusName":"Автор","data":"Андрей Олегович Белянин","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Век Святого Скиминока","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"410 с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Фантастические романы, повести, рассказы","Отечественные"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2002","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":[],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":[],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"5-7632-0847-1","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"642990158","field":"tag='001'"},"author":{"rusName":"Автор","data":"Юрий Михайлович Лотман","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Александр Сергеевич Пушкин. Биография писателя","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"223 с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":[],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"1983","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":[],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":[],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"688881839","field":"tag='001'"},"author":{"rusName":"Автор","data":"Дарья Аркадьевна Донцова","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Бриллиант мутной воды","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"427, [1] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Детективные романы, повести, рассказы","Отечественные"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2002","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":[],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"5-699-00786-5","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"648447245","field":"tag='001'"},"author":{"rusName":"Автор","data":"Николай Альбертович Кун","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Легенды и мифы Древней Греции","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"314, [4] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Легенды и предания","Древняя Греция"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"1991","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Тимофеева Н. К."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":[],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"5-02-030228-7","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"250662112","field":"tag='001'"},"author":{"rusName":"Автор","data":"Майк Омер","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Внутри убийцы","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"416, [3] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Проза зарубежная","Романы, повести, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2022","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Посецельский А. А."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, достигших возраста шестнадцати лет","для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-04-105557-8","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"274315420","field":"tag='001'"},"author":{"rusName":"Автор","data":"Хелен Расселл","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Хороший год, или Как я научилась принимать неудачи, отказалась от романтических комедий и перестала откладывать жизнь \"на потом\"","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"441, [7] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Счастье(психол.)"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2020","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Новикова Т. О."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, достигших возраста шестнадцати лет"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-04-105582-0","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"965510039","field":"tag='001'"},"author":{"rusName":"Автор","data":"Джон Грин","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Многочисленные Катерины","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"253, [2] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Проза зарубежная","Романы, повести, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2015","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Зайцев А. Н."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, достигших возраста шестнадцати лет","для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-386-07982-6","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"154000168","field":"tag='001'"},"author":{"rusName":"Автор","data":"Стивен Кинг","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Под Куполом","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"1114, [3] с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Проза зарубежная","Романы, повести, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2020","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Вебер В. А. Виктор Анатольевич"],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["информационная продукция для детей, достигших возраста шестнадцати лет","для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"978-5-17-074852-5","field":"tag=\"10\" -> subfield code=\"a\""}}{"id":{"rusName":"ID","data":"076409392","field":"tag='001'"},"author":{"rusName":"Автор","data":"Дэн Браун","field":"tag=\"700\" -> subfield code=\"g\" + subfield code=\"a\""},"title":{"rusName":"Название","data":"Ангелы и демоны","field":"tag=\"200\" -> subfield code=\"a\""},"pageCounts":{"rusName":"Кол-во стр.","data":"606 с.","field":"tag=\"215\" -> subfield code=\"a\""},"tags":{"rusName":"Ключевые слова","data":["Зарубежная литература","Романы, повести, рассказы"],"field":" tag=\"606\" -> subfield code=\"a\" + code=\"x\""},"isStoryCollection":{"rusName":"Сборник","data":"No","field":"tag=\"461\" -> subfield code=\"v\""},"lang":{"rusName":"Язык","data":"rus","field":"tag=\"101\" -> subfield code=\"a\""},"issueYear":{"rusName":"Год выпуска","data":"2005","field":"tag=\"210\" -> subfield code=\"d\""},"translator":{"rusName":"Переводчик","data":["Косов Г. Б."],"field":"tag=\"702\" -> subfield code=\"a\" + subfield code=\"b\""},"ageLimit":{"rusName":"Возрастные ограничения","data":["для детей старшего школьного возраста (7 - 9 класс)"],"field":"tag=\"333\" -> subfield code=\"a\""},"ISBN":{"rusName":"ISBN","data":"5-17-028079-3","field":"tag=\"10\" -> subfield code=\"a\""}} */
